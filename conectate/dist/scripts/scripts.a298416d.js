"use strict";angular.module("conectateApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","angularUtils.directives.dirPagination","angularBootstrapNavTree","ng-breadcrumbs","ui.bootstrap","conectateServices"]).config(["$routeProvider","paginationTemplateProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main",label:"Incio"}).when("/resources/:itemId",{templateUrl:"views/itemView.html",controller:"ItemCtrl",controllerAs:"item",label:"recurso"}).otherwise({redirectTo:"/"}),b.setPath("views/dirPagination.tpl.html")}]),angular.module("conectateApp").controller("MainCtrl",["$scope","$http","breadcrumbs","Items","dataService","$window","Search","Meta","Communities","Collections","Items_Col",function(a,b,c,d,e,f,g,h,i,j,k){function l(b,c){""===b&&""===c?a.items=d.get(function(b){a.getMetadata(b[0].id)}):a.items=d.get({limit:b,offset:c},function(b){for(var c=0;c<b.length;c++)a.items[c].meta=m(a.items[c].metadata)})}function m(a){for(var b={},c=0;c<a.length;c++)b[a[c].key]=a[c].value;return b}function n(a){var b=[];if(console.log(a.length),a.length>0){var c=0;angular.forEach(a,function(a,d){b[c]={label:a.name,children:o(a),data:[{id:a.id}]},c++},b)}return b}function o(a){var b;return angular.isDefined(a.subcommunities)&&angular.isArray(a.subcommunities)&&a.subcommunities.length>0&&(b=n(a.subcommunities)),b}a.breadcrumbs=c,a.currentPage=1,a.pageSize=6,a.totalItems=100,a.communities=[],a.collections=[],a.hideCollections=!0,a.dataTree=[],a.dataTreeCollection=[];var p;a.pagination={current:1},l(20,0),a.pageChanged=function(b){l(a.pageSize,b*a.pageSize)},a.getMetadata=function(c,d){b.get("https://trydspace.longsight.com/rest/items/"+c+"/metadata").success(function(b){a.items[d].meta=m(b)})},a.communities=i.get(function(b){var c=angular.fromJson(b);a.dataTree=n(c),a.my_tree=p={}}),a.select_community=function(b){a.community_name=b.label,a.hideCollections=!1,a.collections=j.get({id:b.data[0].id},function(b){var c=angular.fromJson(b);a.dataTreeCollection=n(c),a.my_tree_col=p={}})},a.select_collection=function(b){a.collection_name=b.label,a.hideTitleCollection=!1,a.items=k.get({id:b.data[0].id},function(b){for(var c=0;c<b.length;c++)a.getMetadata(b[c].id,c)})},a.goItem=function(a){e.set(a),f.location.href="/#/resources/"+a},a.search=function(){console.log(a.query),a.items=g.query({query:a.query})}}]).directive("communities",function(){return{templateUrl:"views/communities.html"}}),angular.module("conectateApp").controller("ItemCtrl",["$scope","$http","breadcrumbs","$modal","dataService","Item","$route",function(a,b,c,d,e,f,g){function h(a){for(var b={},c=0;c<a.length;c++)b[a[c].key]=a[c].value;return b}function i(a,c,d){b.get("https://trydspace.longsight.com/rest"+a,{responseType:"arraybuffer"}).success(function(a){var b=new Blob([a],{type:c});saveAs(b,d)})}a.breadcrumbs=c,a.id=g.current.params.itemId,a.item=f.get({id:a.id},function(b){a.item.meta=h(b.metadata)}),a.open=function(b){d.open({animation:a.animationsEnabled,templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",size:b,resolve:{items:function(){return a.item}}})},a.downloadBit=function(){console.log(a.item.bitstreams.length);for(var b=0;b<a.item.bitstreams.length;b++)i(a.item.bitstreams[b].retrieveLink,a.item.bitstreams[b].mimeType,a.item.bitstreams[b].name)}}]),angular.module("conectateApp").controller("ModalInstanceCtrl",["$scope","$modalInstance","items",function(a,b,c){a.item=c,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("conectateApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]});var conectateServices=angular.module("conectateServices",["ngResource"]);conectateServices.factory("Items",["$resource",function(a){return a("https://trydspace.longsight.com/rest/items/",{},{get:{method:"GET",params:{limit:"@limit",offset:"@offset",expand:"metadata"},isArray:!0}})}]),conectateServices.factory("Item",["$resource",function(a){return a("https://trydspace.longsight.com/rest/items/:id/",{},{get:{method:"GET",params:{id:"@id",expand:"metadata,parentCollection,bitstreams"}}})}]),conectateServices.factory("Meta",["$resource",function(a){return a("https://trydspace.longsight.com/rest/items/55/metadata",{},{get:{method:"GET",params:{id:"@id"},isArray:!0}})}]),conectateServices.factory("Communities",["$resource",function(a){return a("https://trydspace.longsight.com/rest/communities/",{},{get:{method:"GET",params:{id:"@id"},isArray:!0}})}]),conectateServices.factory("Collections",["$resource",function(a){return a("https://trydspace.longsight.com/rest/communities/:id/collections",{},{get:{method:"GET",params:{id:"@id"},isArray:!0}})}]),conectateServices.factory("Items_Col",["$resource",function(a){return a("https://trydspace.longsight.com/rest/collections/:id/items",{},{get:{method:"GET",params:{id:"@id"},isArray:!0}})}]),conectateServices.factory("dataService",function(){function a(a){c=a}function b(){return c}var c={};return{set:a,get:b}}),conectateServices.factory("Search",["$resource",function(a){return a("http://path/to/rest/search.json",{},{query:{method:"GET",params:{query:"@query"},isArray:!0}})}]),function(a){if(a.URL=a.URL||a.webkitURL,a.Blob&&a.URL)try{return void new Blob}catch(b){}var c=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||function(a){var b=function(a){return Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1]},c=function(){this.data=[]},d=function(a,b,c){this.data=a,this.size=a.length,this.type=b,this.encoding=c},e=c.prototype,f=d.prototype,g=a.FileReaderSync,h=function(a){this.code=this[this.name=a]},i="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),j=i.length,k=a.URL||a.webkitURL||a,l=k.createObjectURL,m=k.revokeObjectURL,n=k,o=a.btoa,p=a.atob,q=a.ArrayBuffer,r=a.Uint8Array,s=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(d.fake=f.fake=!0;j--;)h.prototype[i[j]]=j+1;return k.createObjectURL||(n=a.URL=function(a){var b,c=document.createElementNS("http://www.w3.org/1999/xhtml","a");return c.href=a,"origin"in c||("data:"===c.protocol.toLowerCase()?c.origin=null:(b=a.match(s),c.origin=b&&b[1])),c}),n.createObjectURL=function(a){var b,c=a.type;return null===c&&(c="application/octet-stream"),a instanceof d?(b="data:"+c,"base64"===a.encoding?b+";base64,"+a.data:"URI"===a.encoding?b+","+decodeURIComponent(a.data):o?b+";base64,"+o(a.data):b+","+encodeURIComponent(a.data)):l?l.call(k,a):void 0},n.revokeObjectURL=function(a){"data:"!==a.substring(0,5)&&m&&m.call(k,a)},e.append=function(a){var c=this.data;if(r&&(a instanceof q||a instanceof r)){for(var e="",f=new r(a),i=0,j=f.length;j>i;i++)e+=String.fromCharCode(f[i]);c.push(e)}else if("Blob"===b(a)||"File"===b(a)){if(!g)throw new h("NOT_READABLE_ERR");var k=new g;c.push(k.readAsBinaryString(a))}else a instanceof d?"base64"===a.encoding&&p?c.push(p(a.data)):"URI"===a.encoding?c.push(decodeURIComponent(a.data)):"raw"===a.encoding&&c.push(a.data):("string"!=typeof a&&(a+=""),c.push(unescape(encodeURIComponent(a))))},e.getBlob=function(a){return arguments.length||(a=null),new d(this.data.join(""),a,"raw")},e.toString=function(){return"[object BlobBuilder]"},f.slice=function(a,b,c){var e=arguments.length;return 3>e&&(c=null),new d(this.data.slice(a,e>1?b:this.data.length),c,this.encoding)},f.toString=function(){return"[object Blob]"},f.close=function(){this.size=0,delete this.data},c}(a);a.Blob=function(a,b){var d=b?b.type||"":"",e=new c;if(a)for(var f=0,g=a.length;g>f;f++)Uint8Array&&a[f]instanceof Uint8Array?e.append(a[f].buffer):e.append(a[f]);var h=e.getBlob(d);return!h.slice&&h.webkitSlice&&(h.slice=h.webkitSlice),h};var d=Object.getPrototypeOf||function(a){return a.__proto__};a.Blob.prototype=d(new a.Blob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),angular.module("conectateApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/communities.html",'<div class="panel panel-info rightPanel"> <div class="panel-heading"><h4>Comunidades</h4></div> <div class="panel-body"> <abn-tree tree-data="dataTree" tree-control="my_tree" on-select="select_community(branch)" expand-level="2"></abn-tree> </div> </div> <div class="panel panel-info rightPanel" ng-hide="hideCollections"> <div class="panel-heading"><h4>{{community_name}}</h4></div> <div class="panel-body"> <abn-tree tree-data="dataTreeCollection" tree-control="my_tree_col" on-select="select_collection(branch)" expand-level="2"></abn-tree> </div> </div>'),a.put("views/dirPagination.tpl.html",'<ul class="pagination" ng-if="1 < pages.length || !autoHide"> <li ng-if="boundaryLinks" ng-class="{ disabled : pagination.current == 1 }"> <a href="" ng-click="setCurrent(1)">&laquo;</a> </li> <li ng-if="directionLinks" ng-class="{ disabled : pagination.current == 1 }"> <a href="" ng-click="setCurrent(pagination.current - 1)">&lsaquo;</a> </li> <li ng-repeat="pageNumber in pages track by tracker(pageNumber, $index)" ng-class="{ active : pagination.current == pageNumber, disabled : pageNumber == \'...\' }"> <a href="" ng-click="setCurrent(pageNumber)">{{ pageNumber }}</a> </li> <li ng-if="directionLinks" ng-class="{ disabled : pagination.current == pagination.last }"> <a href="" ng-click="setCurrent(pagination.current + 1)">&rsaquo;</a> </li> <li ng-if="boundaryLinks" ng-class="{ disabled : pagination.current == pagination.last }"> <a href="" ng-click="setCurrent(pagination.last)">&raquo;</a> </li> </ul>'),a.put("views/itemView.html",'<div id="container" ng-controller="ItemCtrl" class="container"> <ol class="breadcrumb"> <li ng-repeat="breadcrumb in breadcrumbs.get() track by breadcrumb.path" ng-class="{ active: $last }"> <a ng-if="!$last" ng-href="#{{ breadcrumb.path }}" ng-bind="breadcrumb.label" class="margin-right-xs"></a> <span ng-if="$last" ng-bind="breadcrumb.label"></span> </li> </ol> <div class="container_item"> <div class="row"> <div class="col-md-4"> <img ng-if="item[0] != \'\'" ng-src="images/backgrounds/thumbnail_not_found.f8b514fe.png" alt="..." width="250"> <img ng-if="item[0] == \'\'" ng-src="{{item[0].technical[0].thumbails}}" alt="..." width="150"> <h3>Objetivo educativo</h3> <button type="button" class="btn btn-primary" ng-click="open()">Ver detalle</button> <button type="button" class="btn btn-success" ng-click="downloadBit()">Descargar</button> </div> <div class="col-md-6"> <h3>Título</h3> <p>{{item.meta[\'dc.title\']}}</p> <h3>Descripción</h3> <p>{{item.meta[\'dc.description\']}}</p> <h3>Autor(es)</h3> <p>{{item.meta[\'dc.contributor.author\']}}</p> <h3>Palabras clave</h3> <p>{{item.meta[\'dc.subject\']}}</p> <h3>Fecha</h3> <p>{{item.meta[\'dc.date.issued\']}}</p> <button type="button" class="btn btn-primary" ng-click="open()">Requerimientos técnicos</button> </div> </div> </div> </div> <script type="text/ng-template" id="myModalContent.html"><div class="modal-header">\r\n            <h3 class="modal-title">Requerimientos técnicos</h3>\r\n        </div>\r\n        <div class="modal-body">\r\n        <table class="table table-striped table-condensed">\r\n        	<tr>\r\n            	<td><strong>Formato:</strong></td><td> {{item[0].technical[0].format}}</td>\r\n            </tr>\r\n            <tr>\r\n            	<td><strong>Tamaño:</strong></td><td> {{item[0].technical[0].size}}</td>\r\n            </tr>\r\n            <tr>\r\n            	<td><strong>Ubicación:</strong></td><td> {{item[0].technical[0].location}}</p></td>\r\n            </tr>\r\n            <tr>\r\n            	<td><strong>Tipo:</strong></td><td> {{item[0].technical[0].requirements_orcomposite_type}}</td>\r\n            </tr>\r\n            <tr>\r\n            	<td><strong>Nombre:</strong></td><td> {{item[0].technical[0].requirements_orcomposite_name}}</td>\r\n            </tr>\r\n            <tr>\r\n            	<td><strong>Versión mínima:</strong></td><td> {{item[0].technical[0].requirements_orcomposite_minimunversion}}</td>\r\n            </tr>\r\n            <tr>\r\n            	<td><strong>Versión máxima:</strong></td><td> {{item[0].technical[0].requirements_orcomposite_maximunversion}}</td>\r\n            </tr>\r\n            <tr>\r\n            	<td><strong>Instrucciones de instalación</strong></td><td> {{item[0].technical[0].installationinstructions}}</td>\r\n            </tr>\r\n            <tr>\r\n            	<td><strong>Otros requerimientos</strong></td><td> {{item[0].technical[0].installationinstructions_otherrequirements}}</td>\r\n            </tr>\r\n            <tr>\r\n            	<td><strong>Vida</strong></td><td> {{item[0].technical[0].life}}</td>\r\n            </tr>\r\n            <tr>\r\n            	<td><strong>Thumbnails</strong></td><td> {{item[0].technical[0].thumbails}}</td>\r\n            </tr>\r\n            <tr>\r\n            	<td><strong>Previews</strong></td><td> {{item[0].technical[0].previews}}</td>\r\n            </tr>\r\n            <tr>\r\n            	<td><strong>Promo imagen</strong></td><td> {{item[0].technical[0].promoimages}}</td>\r\n            </tr>\r\n        </table>\r\n        </div>\r\n        <div class="modal-footer">\r\n            <button class="btn btn-primary" type="button" ng-click="ok()">OK</button>\r\n            <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\r\n        </div></script>'),a.put("views/main.html",'<div id="container" ng-controller="MainCtrl" class="container"> <ol class="breadcrumb"> <li ng-repeat="breadcrumb in breadcrumbs.get() track by breadcrumb.path" ng-class="{ active: $last }"> <a ng-if="!$last" ng-href="#{{ breadcrumb.path }}" ng-bind="breadcrumb.label" class="margin-right-xs"></a> <span ng-if="$last" ng-bind="breadcrumb.label"></span> </li> </ol> <div class="input-group"> <input class="form-control" placeholder="Buscar por..." ng-model="query"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-click="search()">Buscar</button> </span> </div> <div id="content"> <div class="row panelHome"> <div class="col-xs-4 orderList"> <select ng-model="orderItems" class="form-control"> <option value="">Ordenar Por:</option> <option value="meta[\'dc.title\']">Nombre</option> <option value="meta[\'dc.date.issued\']">Fecha</option> </select> </div> <div class="col-xs-4"> <label for="search">Recursos por página:</label> <input type="number" min="6" max="100" class="form-control" ng-model="pageSize"> </div> <h3 style="clear:both;padding:30px 0">Recursos Conecta-Te</h3> <h4 style="clear:both" ng-hide="hideTitleCollection">{{collection_name}}</h4> <div class="row"> <div class="col-sm-6 col-md-4" dir-paginate="item in items | filter:query | orderBy:orderItems | itemsPerPage: pageSize" current-page="currentPage" total-items="totalItems"> <div class="thumbnail"> <img ng-if="!angular.isDefined(item.meta[\'cem.technical.thumbails\'])" ng-src="images/backgrounds/thumbnail_not_found.f8b514fe.png" alt="..." width="180"> <img ng-if="angular.isDefined(item.meta[\'cem.technical.thumbails\'])" ng-src="{{item.meta[\'cem.technical.thumbails\']}}" alt="..." width="150"> <div class="caption"> <p><strong>{{item.meta[\'dc.title\']}}</strong></p> <p><small><strong>Tipo de recurso: </strong>{{item.meta[\'dc.type\']}} </small></p> <p><small><strong>Autor: </strong>{{item.meta[\'dc.contributor.author\']}} </small></p> <p><small><strong>Fecha: </strong>{{item.meta[\'dc.date.issued\']}} </small></p> <p><small><strong>Palabras Claves: </strong>{{item.meta[\'dc.subject.keyword\']}} </small></p> <p><small><strong>Estado: </strong>{{item.state}} </small></p> </div> <p><a ng-href="#/resources/{{item.id}}" ng-click="" class="btn btn-primary" role="button">Ver</a> </p></div> </div> </div> <div class="text-center"> <dir-pagination-controls boundary-links="true" on-page-change="pageChanged(newPageNumber)"></dir-pagination-controls> </div> </div> </div> <div communities></div> </div>')}]);